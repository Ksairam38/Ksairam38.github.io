<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SignalRClient</title>
  </head>
  <body>
    <h2>Data loaded from the Web API:</h2>
    <div id="offersContainer" class="alert alert-warning" role="alert"></div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/5.0.0/signalr.min.js"></script>
    <script>
      const offersContainer = document.getElementById("offersContainer");

      // Example data to be sent to the server
      const userData = {
        businessId: "your-business-id",
        userId: "your-user-id",
        operations: {
          // ... additional operations data
        },
      };

      const hubConnection = new signalR.HubConnectionBuilder()
        .withUrl("https://localhost:44381/conversations", {
          transport: signalR.HttpTransportType.WebSockets,
          httpProtocolOptions: {
            transferMode: signalR.TransferMode.Binary,
            skipNegotiation: true,
          },
          accessTokenFactory: () => null, // Required for WebSockets transport
        })
        .withHubProtocol(new signalR.protocols.JsonHubProtocol())
        .configureLogging(signalR.LogLevel.Information)
        .build();

      hubConnection.on("SendOffersToUser", (conversations) => {
        const listItem = document.createElement("li");
        console.log(conversations);
        listItem.textContent = "Offers: " + conversations;
        offersContainer.appendChild(listItem);
      });

      hubConnection
        .start(userData)
        .then(() => console.log("Connection started.......!"))
        .catch((err) => console.log("Error while connecting to server:", err));
    </script>
  </body>
</html>
